
<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7 ie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8 ie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9 ie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Creating And Publishing A New Relic Passenger Plugin</title>
	<meta name="author" content="Michael">
	<link href='/assets/themes/the-minimum/css/style.css' rel="stylesheet" media="all">
	<link href="http://feeds.feedburner.com/" rel="alternate" title="Creating And Publishing A New Relic Passenger Plugin" type="application/atom+xml">
	<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js"></script>
</head>
<body>

<div id="page" class="hentry">
	<header class="the-header">
		<div class="unit-head">
			<div class="unit-inner unit-head-inner">
				<p class="logo"><a href="/">Tamaloa's Blog</a></p>
				<nav class="nav-global">
					<ul>
						<li class="archive"><a href="/archive.html">archive</a></li>
						<li class="page"><a href="/pages.html">pages</a></li>
						<li class="category"><a href="/categories.html">categories</a></li>
						<li class="tag"><a href="/tags.html">tags</a></li>
					</ul>
				</nav>
			</div><!-- unit-inner -->
		</div><!-- unit-head -->
	</header>
	<div class="body" role="main">
		<div class="unit-body">
			<div class="unit-inner unit-body-inner">
				<div class="entry-content">
					
<article class="unit-article layout-post">
	<div class="unit-inner unit-article-inner">
		<div class="content">
			<header>
				<div class="unit-head">
					<div class="unit-inner unit-head-inner">
						<h1 class="h2 entry-title">Creating And Publishing A New Relic Passenger Plugin</h1>
					</div><!-- unit-inner -->
				</div><!-- unit-head -->
			</header>

			<div class="bd">
				<div class="entry-content">
					
<p><a href="http://newrelic.com/">New Relic</a> Plattform now allows custom agents to
report performance metrics. There exist several SDK to pick from as well
as an web API.</p>

<p>We use <a href="https://www.phusionpassenger.com/‎">Phusion Passenger</a> web server
to deploy our Rails apps. New Relic already helps a lot in fixing
performance issues inside the apps. Since we started using the New Relic
server monitoring agents our previous setup has become somewhat
obsolete. Prior we were running munin to gather statistics on our
servers and applications. We were using the default ubuntu 12.04
packages with a custom theme (the built in one is just terrible). To
monitor our rails apps we used the
<a href="https://github.com/barttenbrinke/munin-plugins-rails">munin-plugin-rails</a>
gem which gathers data on</p>

<ul>
  <li>rails apps by parsing the log files</li>
  <li>passenger web server by using the provided command line utilities</li>
</ul>

<p>Parsing rails logs does provide some basic information on the
applications performance. But it makes changing the Rails log formant
difficult (and Rails log format is NOT production ready) and of course
New Relic is just so much nicer to look at :)\
The information gathered for passenger was still quite useful and not
available in New Relic but munin is just really terrible if you actually
want to do more than just have a quick look at the long term development
(drilldown, setting timeperiods etc. is not possible). Also we wanted to
know how much memory was used per Rails-App (we have a multiapp deploy
per passenger webserver). So either we would have to add code to the
munin plugins … or try out the (kinda) new New Relic plugin
architecture.</p>

<p>And yes - it is suprisingly easy to write a custom New Relic agent.</p>

<ol>
  <li>Download Ruby example agent</li>
  <li>add some code to gather data (here easy: copy from munin gem)\
<code class="highlighter-rouge">passenger_status_output =~ /count\s+=\s+(\d+)/</code></li>
  <li>send data to New Relic\
<code class="highlighter-rouge">report_metric "passenger.processes.running", "Processes", $1</code></li>
  <li>start agent on your server (add your license key first)</li>
  <li>Metrics start to show up in New Relic UI</li>
  <li>Adjust UI (click, drag, drop, finished)</li>
</ol>

<p><img src="/assets/images/newrelic-editing-plugin-dashboard_640.png" alt="Screenshot showing editing the plugin dashboard" title="Screenshot showing editing the plugin dashboard" /></p>

<p>Later you can publish the Agent … I have the feeling New Relic makes
this harder than it should be. Most likely because there is no QA for
the plugins listed in their plugins directory. I feel it would be easier
if the UI configuration could be stored as a config file and versioned
alongside the agent code. This would allow useful sharing of agents
without the need of publishing them (i.e. if they really are just a
hack - as this one :).</p>

<p>Anyway, reading the <a href="https://newrelic.com/docs/plugin-dev/publishing-your-plugin-to-plugin-central">publishing
documentation</a>
makes you think it is real hard to publish a plugin. You need a company
site, contact and support information and a whole load of requirements.</p>

<p>But actually you need no more than to host your plugin on github (or
similar). This provides you with a webpage (github readme) a contact and
support possibility (github issue page) and download link (github
repository as zip link). Also the actual publishing process is a simple
one page form …</p>

<p><img src="/assets/images/newrelic-publishing-plugin_600.png" alt="Screenshot of publishing form for a on New Relic plugin" title="Screenshot of publishing form for a on New Relic plugin" /></p>

<p>And after accepting the <a href="https://rpm.newrelic.com/terms_of_service/developer">terms of service
stuff</a> (#TODO: Read
them) the plugin appears at the bottom of the plugins directory</p>

<p><img src="/assets/images/newrelic-plugins-repository-with-freshly-published-plugin_640.png" alt="Screenshot of plugins directory with the newly created plugin at the bottom" title="Screenshot of plugins directory with the newly created plugin at the bottom" /></p>


					<div class="meta">
						<p class="date-publish">
							Published: 
							<date class="date-pub" title="2013-09-03T00:00:00+02:00" datetime="2013-09-03T00:00:00+02:00" pubdate>
							<span class="month"><abbr>September</abbr></span>
							<span class="day">03</span>
							<span class="year">2013</span>
							</date>
						</p>
						<ul class="list-category list-linear">
							<li class="list-head">category: </li>
							
							


  
    
  


						</ul>
						<ul class="list-tag list-linear">
							<li class="list-head">tags: </li>
							
							


  
     
    	<li><a href="/tags.html#monitoring-ref">monitoring <span>1</span></a></li>
     
    	<li><a href="/tags.html#ruby-ref">ruby <span>1</span></a></li>
     
    	<li><a href="/tags.html#passenger-ref">passenger <span>1</span></a></li>
    
  



						</ul>
					</div><!-- meta -->
				</div><!-- entry-content -->
                <div class="misc-content">
                    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'tamaloasblog'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




                </div>
                <!-- misc-content -->

            </div><!-- bd -->
			<footer class="unit-foot">
				<div class="unit-inner unit-foot-inner">
					<nav class="pagination">
						<ul>
							
							<li class="prev"><a class="internal" rel="prev"  href="/2013/07/26/diff-rails3-rails4" title="View Diffing a fresh rails 3 app against a rails 4 app">&laquo; Diffing a fresh rails 3 app against a rails 4 app</a></li>
							
							
							<li class="pipe"> | </li>
							
							
							<li class="next"><a class="internal" rel="next"  href="/2013/11/11/ubuntu-servers-most-annoying-boot-partition-full" title="View Working around ubuntu server's most annoying /boot partition full">Working around ubuntu server's most annoying /boot partition full &raquo;</a></li>
							
						</ul>
					</nav>
					<p class="gotop">
						<a href="#page">Back to Top</a>
					</p>
				</div>
			</footer>

		</div><!-- content -->
	</div><!-- unit-inner -->
</article>


				</div>
			</div><!-- unit-inner -->
		</div><!-- unit-body -->
	</div><!-- body -->
	<footer class="the-footer">
		<div class="unit-foot">
			<div class="unit-inner unit-foot-inner">
				<div class="misc vcard">
					<h4>about</h4>
					<ul>
						<li class="contact"><address><span class="author fn n">Michael</span></address></li>
						<li class="github"><a href="http://github.com/tamaloa/" rel="me">github.com/tamaloa</a></li>
					</ul>
				</div><!-- misc -->
				<p class="licence">
					Theme: <a href="http://layouts-the.me">the_minimum</a> based on <a href="http://jekyllbootstrap.com/">Jekyll-bootstrap</a>.<br>
					Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a>.
				</p>
			</div><!-- unit-foot-inner -->
		</div><!-- unit-foot -->
	</footer>
</div><!-- page -->
<script>
	(function(d, s) {
		var js, fjs = d.getElementsByTagName(s)[0], load = function(url, id) {
		if (d.getElementById(id)) {return;}
		js = d.createElement(s); js.src = url; js.id = id;
		fjs.parentNode.insertBefore(js, fjs);
		};
	load('//platform.twitter.com/widgets.js', 'tweetjs');
	// load('https://apis.google.com/js/plusone.js', 'gplus1js'); // Checkout http://j.mp/ApDgMr for usage html for this is <div class="g-plusone" data-size="medium"></div>
	// load('//connect.facebook.net/en_US/all.js#xfbml=1', 'fbjssdk'); // Checkout http://j.mp/wZw2xR for using open graph protorol html for this is <div class="fb-like" data-href="/2013/09/03/creating-and-publishing-a-newrelic-passenger-plugin" data-send="false" data-layout="button_count" data-width="450" data-show-faces="false" data-font="verdana"></div>
	}(document, 'script'));
</script>
<script>
/*! A fix for the iOS orientationchange zoom bug.Script by @scottjehl, rebound by @wilto. MIT License.*/
(function(j){var i=j.document;if(!i.querySelectorAll){return}var l=i.querySelectorAll("meta[name=viewport]")[0],a=l&&l.getAttribute("content"),h=a+", maximum-scale=1.0",d=a+", maximum-scale=10.0",g=true,c=j.orientation,k=0;if(!l){return}function f(){l.setAttribute("content",d);g=true}function b(){l.setAttribute("content",h);g=false}function e(m){c=Math.abs(j.orientation);k=Math.abs(m.gamma);if(k>8&&c===0){if(g){b()}}else{if(!g){f()}}}j.addEventListener("orientationchange",f,false);j.addEventListener("deviceorientation",e,false)})(this);
</script>

  
</body>
</html>

